rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // dahiOS Tags - Sadece okuma (public)
    match /dahios_tags/{dahiosId} {
      allow read: if true;
      allow write: if false; // Sadece admin panelinden yazılabilir
    }

    // dahiOS Scans - Sadece yazma (public), okuma yok
    match /dahios_scans/{scanId} {
      allow read: if false; // Sadece admin panelinden okunabilir
      allow create: if true; // Herkes scan kaydedebilir
      allow update, delete: if false;
    }

    // App Versions - Public read (herkes okuyabilir)
    match /app_versions/{platform} {
      allow read: if true;
      allow write: if false; // Sadece admin panelinden yazılabilir
    }

    // Users - Sadece kendi verilerini okuyabilir/yazabilir
    // Ancak authenticated kullanıcılar diğer kullanıcıların document'lerini
    // sadece device kontrolü için okuyabilir (güvenlik: sadece devices field'ı kullanılacak)
    match /users/{userId} {
      allow read: if request.auth != null; // Device kontrolü için tüm authenticated kullanıcılar okuyabilir
      allow write: if request.auth != null && request.auth.uid == userId; // Sadece kendi verilerini yazabilir
      allow create: if request.auth != null && request.auth.uid == userId;
    }

    // Characters - Public read (herkes okuyabilir)
    match /characters/{characterId} {
      allow read: if true;
      allow write: if false; // Sadece admin scriptinden yazılabilir
    }

    // Five Forces online rooms (lobby + game state sync)
    match /ff_rooms/{roomId} {
      allow get, list: if true;
      allow create, update, delete: if true;
    }

    // Seasons - Public read (herkes okuyabilir)
    match /seasons/{seasonId} {
      allow read: if true;
      allow write: if false; // Sadece admin scriptinden yazılabilir
      // Episodes subcollection
      match /episodes/{episodeId} {
        allow read: if true;
        allow write: if false; // Sadece admin scriptinden yazılabilir
      }
    }
  }
}

